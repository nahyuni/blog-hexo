---
title: [마이크로 서비스 활용]
date: 2020-03-31 14:30:19
tags: [microservice]
categories: 
    - 개발
thumbnail: ""
permalink: ""
---
## 넷플릭스의 마이크로 서비스 프레임웍 오픈소스 예

![](/images/99C3BD4B5BF3A99708.png)
 사용법이 복잡하다는 것이다. Hystrix 하나만을 적용하는데도 많은 노력이 필요한데, 여러개의 프레임웍을 적용하는 것은 여간 어려운 일이 아니다.

그런데 여기서 스프링 프레임웍이 이런 문제를 풀어내는 기여를 한다. 스프링 프레임웍에 넷플릭스의 마이크로 서비스 오픈 소스 프레임웍을 통합 시켜 버린것이다. (http://spring.io/projects/spring-cloud-netflix) 

복잡한 부분을 추상화해서 스프링 프레임웍을 적용하면 손쉽게 넷플릭스의 마이크로 서비스 프레임웍을 사용할 수 있게 해줬는데, 마지막 문제가 남게 된다. 스프링은 자바 개발 프레임웍이다. 즉 자바에만 적용이 가능하다.
<!-- more --> 
## 서킷 브레이커
서킷 브레이커 패턴은 개념적으로 전기 시스템에서의 회로 차단기/누전 차단기와 같다. 일정 수준(임계치) 이상의 전기를 소모하게 되면 누전 차단기가 작동하는 것처럼 호출하고자 하는 다른 서비스에 문제가 지속해서 생길 경우 해당 문제가 설정한 임계치 기준에 다다르면 서킷(Circuit, 회로)이 열려 차단기가 작동하게 된다. 
 - 각 서비스간 의존성이 높은 경우 연속적으로 장애가 발생할수 있다. 이런 의존성 문제를 해결하기 위해 fallback을 활용하여 서비스에 오류가 있더라도 사전에 지정된 응답을 전달하거나 전달받아 다른 서비스에 영향을 주지 않도록 한다.
 
 - 서킷 브레이커

![](/images/993CF6395BF3A99722.png)

## 서비스 매쉬
### 프록시
이러한 마이크로 서비스의 문제를 풀기 위해서 소프트웨어 계층이 아니라 인프라 측면에서 이를 풀기 위한 노력이 서비스 매쉬라는 아키텍쳐 컨셉이다. 

아래와 같이 서비스와 서비스간의 호출이 있을때 이를 직접 서비스들이 호출을 하는 것이 아니라 서비스 마다 프록시를 넣는다.

이렇게 하면 서비스로 들어오거나 나가는 트래픽을 네트워크 단에서 모두 통제가 가능하게 되고, 트래픽에 대한 통제를 통해서 마이크로 서비스의 여러가지 문제를 해결할 수 있다. 

예를 들어 앞에서 설명한 써킷 브레이커와 같은 경우에는 호출되는 서비스가 응답이 없을때 프록시에서 이 연결을 끊어서 장애가 전파되지 않도록 하면된다. 

![](/images/997EC8335BF3A99702.png)


### 서비스 매쉬 구조를 구현한 오픈 소스 솔루션인 Istio
https://layer5.io/landscape

아키텍쳐
먼저 Istio의 구조를 보자

![](/images/99D9B3375BF8090D27.png)

#### 데이타 플레인
  각 프록시들로 이루어져서 트래픽을 설정값에 따라 트래픽을 컨트롤 하는 부분을 데이타 플레인(Data Plane)

#### 컨트롤 플레인
1. 파일럿 (Pilot) - 서비스들의 엔드포인트(EndPoint)들의 주소를 얻을 수 있는 서비스 디스커버리 기능을 제공. 이외도 서비스의 안정성을 제공하기 위해서 서비스간에 호출이 발생할때 재시도(retry), 장애 전파를 막기 위한 써킷 브레이커 (Circuit breaker), Timeout 등의 기능을 제공한다.

2. 믹서(Mixer)
믹서가 하는 일은 액세스 컨트롤, 정책 통제 그리고 각종 모니터링 지표의 수집이다. 
예를 들어서 서비스의 총 처리량을 정책으로 지정하여, 그 처리량 이상으로 요청을 못받게 하거나 특정 헤더값이 일치해야 요청을 받을 수 있게 하는 등의 다양한 정책을 정의하고 이를 컨트롤 할 수 있다.
또한 서비스의 응답 시간이나 평균 처리량과 같은 다양한 지표를 수집하여 저장하는 역할을 한다. 

3. 시타델(Citadel)
시타델은 보안에 관련된 기능을 담당하는 모듈이다. 서비스를 사용하기 위한 사용자 인증 (Authentication)과 인가 (Authorization)을 담당한다. 또한 Istio는 통신을 TLS(SSL)을 이용하여 암호화할 수 있는데, TLS 암호화나 또는 사용자 인증에 필요한 인증서(Certification)을 관리하는 역할을 한다.  

#### Istio 설치 및 BookInfo 샘플 애플리케이션 설치
https://bcho.tistory.com/1297?category=731548


## 참조
 https://bcho.tistory.com/1293?category=731548








