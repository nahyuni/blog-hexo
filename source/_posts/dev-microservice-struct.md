---
title: [마이크로 서비스 구조]
date: 2020-02-24 14:30:19
tags: [microservice]
categories: 
    - 개발
thumbnail: ""
permalink: ""
---
## 개요
마이크로서비스 아키텍처는 하나의 큰 애플리케이션을 여러 개의 작은 애플리케이션으로 쪼개어 변경과 조합이 가능하도록 만든 아키텍처를 말합니다.
REST API의 일반화, 도커(Docker)와 같은 컨테이너 기술, 클라우드 컴퓨팅 환경의 발전 등에 힘입어 마이크로서비스는 좀 더 손쉽게 구현될 수 있게 되었습니다.

## 마이크로서비스 아키텍처는 언제 필요한가?
- 애플리케이션의 배포에 한 시간 이상 소요된다.
- 단순한 기능 하나를 수정해도 전체 기능에 대한 QA가 필요하다.
- 단순한 버그 수정이 더 중대한 버그를 생산하는 일이 많아졌다.
- 현재의 애플리케이션을 기능별로 나눈다고 가정했을 때 수십개의 마이크로서비스가 가능하다.
<!-- more --> 
## 모놀리틱 아키텍처 (MONOLITHIC ARCHITECTURE)
![](/images/1.png)
- 일반적인 서비스 구조
<br>

## 마이크로서비스 아키텍처
![](/images/2.png)

- 하나의 큰 서비스를 독립적인 역할을 수행하는 작은 단위의 서비스로 분리하여 설계하는 패턴
- 여기에서 말하는 독립적인 역할이란 주로, ‘사용자 관리’, ‘주문 관리’, ‘결제 관리’, ‘알림 관리’와 같이 기능적인 요소를 의미
- 서비스별로 별도의 데이터베이스를 사용
- 데이터의 특성과 서비스가 가지는 특수성에 따라 가장 효율적인 데이터베이스를 선택 설계 가능.
<br>
## 마이크로서비스 아키텍처에서의 요청 처리
![](/images/6.png)

- 클라이언트가 모든 마이크로서비스의 호스트명은 물론 end_point를 알고 있어야 한다.

### API GATEWAY
-  API Gateway는 시스템의 아키텍처를 내부로 숨기고 외부의 요청에 대한 응답만을 적합한 형태로 응답 함.
- API Gateway는 이처럼 클라이언트의 요청을 일괄적으로 처리하는 역할 뿐만 아니라, 전체 시스템의 부하를 분산시키는 로드 밸런서의 역할, 동일한 요청에 대한 불필요한 반복작업을 줄일 수 있는 캐싱, 시스템상을 오고가는 요청과 응답에 대한 모니터링 역할도 수행할 수 있습니다.

- 시스템 내부의 아키텍처를 숨길 수 있는(encapsulate) 특성이 API Gateway가 갖는 가장 큰 장점

## API GATEWAY 구현시 고려해야할 점들
- API Gateway를 비동기(asynchronous)적이고 non-blocking I/O 처리가 가능하도록 구현됨.
- 개별 마이크로서비스로 보내는 요청의 선후관계가 존재(자바스크립트의 Promise 등으로 구현 가능)
- 분산된 서버의 상태와 여러가지 변수들로 인해서 일부 서비스에 장애가 발생하거나 응답속도가 지연될 가능성이 높아지게 됨.
- 특정서비스에 문제가 발생했을 때 API Gateway는 서비스 장애의 종류에 따라 적절한 처리가 가능하도록 설계/구현 되어야 함.
- API Gateway는 모든 요청이 몰리는 지점이기 때문에 동일한 요청에 대하여 중복적으로 마이크로서비스에 요청을 보내는 것 보다 기존의 결과를 캐싱하여 재활용할 수 있도록 설계하는 것이 중요
<br>

## 프로세스간 통신 IPC(inter-process communication)
- 동기 메시지 기반 통신
동기 요청/응답 기반 : REST, Apache Thrift
- 비동기 메시지 기반 통신
메시지를 전송하는 표준 프로토콜은 AMQP 와 STOMP가 있습니다. 그리고 오픈소스 메시징 시스템에는 RabbitMQ, Apache Kafka, Apache ActiveMQ, NSQ 등이 있습니다.

<br>

## 메시지 포맷
통신 방식을 골랐다면 메시지를 어떤 포맷으로 보낼지 골라야 합니다.

먼저 사람이 읽기 쉽고 이해할 수 있는 XML 과 JSON 이 있습니다. XML 은 XML 스키마로 구조를 정의할 수가 있어서 데이터를 쉽게 검증할 수 있지만 메시지 사이즈가 너무 커집니다. JSON 은 XML 보다 가볍지만 데이터를 검증하기가 쉽지 않았습니다. 그래서 JSON 에서도 XML 처럼 데이터를 검증할 수 있도록 만든 것이 JSON 스키마 입니다.

이런 텍스트 기반 메시지는 텍스트를 파싱하는데 오버헤드가 생깁니다. 따라서 성능을 위해 바이너리 값으로 전송하는 방법도 있습니다. 많이 쓰이는 것으로는 binary Thrift 나 Protocol Buffers, Apache Avro. 등이 있습니다.
## 참조
https://futurecreator.github.io/2018/09/14/what-is-microservices-architecture/
http://guruble.com/%eb%a7%88%ec%9d%b4%ed%81%ac%eb%a1%9c%ec%84%9c%eb%b9%84%ec%8a%a4microservice-%ec%95%84%ed%82%a4%ed%85%8d%ec%b2%98-%ea%b7%b8%ea%b2%83%ec%9d%b4-%eb%ad%a3%ec%9d%b4-%ec%a4%91%ed%97%8c%eb%94%94/